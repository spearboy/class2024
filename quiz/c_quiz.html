<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>c_quiz</title>
    link
    <link rel="stylesheet" href="./asset/css/c_quiz.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>
    <!-- <div class="start_wrap">
        <div class="inner_box">
            <p>정보처리기능사 주관식 문제 풀기</p>
            <div class="start_btn">시작하기</div>
        </div>
    </div> -->
    <main id="main">
        <div class="quiz__wrap">
            <div class="quiz">
                <div class="quiz__header"></div>
                <div class="quiz__main">
                    <div class="question"><span></span></div>
                    <div class="desc"></div>
                    <div class="input">
                        <input id="input" type="text" placeholder="정답을 입력해주세요">
                    </div>
                    <div class="answer none"></div>
                </div >
                <div class="quiz__footer">
                    <button class="confirm">정답 확인하기</button>
                    <button class="next none">다음문제</button>
                </div>
            </div>
        </div>

        
    </main>
    <script>
        // 선택자
        const quizWrap = document.querySelector('.quiz__wrap');

        // 변수
        let currentIndex = 0; // 현재 문제에 대한 값
        let goodNum = 0;
        let badNum = 0;

        let quizInfo = [];

        const fetchQuiz = async () => {
            try {
                const response = await fetch("https://webstoryboy.github.io/webstoryboy/w_json/gineungsaShort.json");
                const items = await response.json();
                
                // Process quiz items
                quizInfo = items.map(item => {
                    const formattedQuiz = {
                        date: item.time,
                        question: item.question,
                        desc: item.question_desc,
                        answer: item.correct_answer,
                    };
                    if (item.question) {
                        formattedQuiz.desc = item.question_desc;
                    }
                    return formattedQuiz;
                });
                quizInfo.splice(5, 178)
                console.log(quizInfo);
                updateQuiz(currentIndex);
            } catch (error) {
                console.error('Error fetching quiz:', error);
            }
        }

        const updateQuiz = (index) => {
            
            let quizWrapTag = `<div class="quiz">
                <div class="quiz__header">
                    <span>${quizInfo.length}문제중 ${index+1}번 문제입니다.</span>
                    ${quizInfo[index].date}
                </div>
                <div class="quiz__main">
                    <div class="question"><span>${quizInfo[index].question}</span></div>
                    <div class="desc">${quizInfo[index].desc}</div>
                    <div class="input">
                        <input id="input" type="text" placeholder="정답을 입력해주세요">
                    </div>
                    <div class="answer none">${quizInfo[index].answer}</div>
                </div >
                <div class="quiz__footer">
                    <button class="confirm">정답 확인하기</button>
                    <button class="next none">다음문제</button>
                </div>
            </div>`;
            quizWrap.innerHTML = quizWrapTag;

            if(quizInfo[index].desc == undefined){
                quizWrap.querySelector('.desc').classList.add('none')
            }
            // 선택자
            const quizConfirm = quizWrap.querySelector('.confirm');
            const quizNext = quizWrap.querySelector('.next');
            // 정답 버튼을 클릭
            quizConfirm.addEventListener('click', () => {
                const quizInput = quizWrap.querySelector(`#input`)
                const userAnswer = quizInput.value
                if (userAnswer == "") {
                    alert('보기를 선택해주세요!');
                } else {
                    const quizAnswer = quizInfo[index].answer
                    const quizElement = quizWrap.querySelector(`.quiz`)
                    const answerElement = quizWrap.querySelector(`.answer`)
                    // const descElement = quizWrap.querySelector(`.desc`)

                    if (userAnswer == quizAnswer) {
                        goodNum++;
                        quizElement.classList.add('good')
                    } else {
                        badNum++;
                        quizElement.classList.add('bad')
                        answerElement.classList.remove('none')
                    }
                    // descElement.classList.remove('none')
                    quizNext.classList.remove('none')
                    quizConfirm.classList.add('none')
                }
            })

            // 다음 문제 버튼을 클릭
            quizNext.addEventListener('click', () => {
                if (currentIndex < quizInfo.length - 1) {
                    currentIndex++;
                    updateQuiz(currentIndex)
                } else {
                    alert((goodNum+badNum)- badNum+"점 입니다.")
                }
            })
        }
        document.addEventListener("DOMContentLoaded", () => {
            fetchQuiz()

            // var startBtn = document.querySelector(".start_btn");
            // var startWrap = document.querySelector(".start_wrap");

            // startBtn.addEventListener("click", function() {
            //     startWrap.style.transition = "opacity 1s";
            //     startWrap.style.opacity = 0;

            //     // 애니메이션이 완료된 후에 요소를 숨깁니다.
            //     setTimeout(function() {
            //         startWrap.style.display = "none";
            //     }, 1000);
            // });
        })
    </script>
</body>

</html>